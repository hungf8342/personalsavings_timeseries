---
title: "Personal Savings Analysis - Rough Draft"
author: "Andrew Brown, Melissa Hooke, Frances Hung, Mai Nguyen, Brenner Ryan"
date: "11/29/2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(TSA)
require(dplyr)
require(astsa)
```

# Time Series Exploration

```{r}
# load the time series
savings = read.csv("savings.csv",header=TRUE, nrows=104)
savings = savings %>% select(2)
savings.entire = savings[1:84,]
savings<-ts(savings, start=c(1955),frequency=4)

# plot the original time series
plot(savings, xlab="Year (by Quarter)", 
     ylab= "Percent of Disposible Income", 
     main= "Time Series of Personal Savings in the US (1955-1980)")
points(y=savings,x=as.vector(time(savings)),pch=as.vector(season(savings)), cex=.75)
abline(mean(savings),0)
```

The time series spans over 26 years with each year divided into financial quarters, amounting to 104 total observations. From our original time series plot, we do not see any obvious seasonal trends. However, there seems to be a positive correlation between terms close to one another. The general increasing trend and volatility in the 70s may be linked to the economic crash in the early 70s and oil energy crisis in 1979. The 1970â€™s were marked by high inflation and growing expenses due to rising interest rates. We took off the last 5 years because there was a huge drop due to a recession. Then we took off the last 6 observations in order to use them as test points at the end. The resulting series is below:

```{r}
# set aside points to validate our forecasts
savings.test = savings[79:84,]

# remove the last 5 years because of the huge dip due to recession
savings = savings[1:78,]
savings<-ts(savings, start=c(1955),frequency=4)

# plot the shortened time series with labels for quarters
plot(savings, xlab="Year (by Quarter)", 
     ylab= "Percent of Disposible Income", 
     main= "Time Series of Personal Savings in the US (1955-1980)")
points(y=savings,x=as.vector(time(savings)),pch=as.vector(season(savings)), cex=.75)
```

There is a general upward trend in the data, as well as a dependence on previous quarters' savings to determine current personal savings percentages. We may want to take a difference to see if that helps with stationarity, but first lets explore without taking the difference.




```{r,warning=FALSE,eval=FALSE}
# should we do a transformation?
boxcox = BoxCox.ar(savings)
boxcox$mle
```

The Boxcox output indicates that a transformation is not necessary in order to stabilize the variance since $\lambda$ is about equal to 1.



```{r}
acf(savings, lag.max = 20)
pacf(savings, lag.max = 20)
```

The PACF seems to indicate that an AR(1) process may be a good candidate model.

# Model Specification

```{r}
# use the eacf and best subsets to find a candidate model
eacf(savings)
sub = armasubsets(y=savings,nar=7,nma=7, y.name='test', ar.method='ols') 
plot(sub)
```

While the EACF is inconclusive, the best subsets method indicates that, an AR(1) process or a multiplicative $AR(1) \times AR(1)_4$ with a seasonal period of 4 are good candidate models.


```{r}
diffs = (savings-zlag(savings))[2:78]
eacf(diffs)
sub = armasubsets(y=diffs,nar=7,nma=7, y.name='test', ar.method='ols') 
plot(sub)
```

For the differenced series, a seasonal period of 6 is being suggested, which doesn't seem to make much sense.



# Model Fitting 

```{r}
# fit an AR(1) process
AR1model = arima(savings, order = c(1, 0, 0), seasonal = list(order = c(0, 0, 0)), method=c('ML'))
AR1model
```

Here are our parameters for the AR(1) model. Given these parameters, the AR(1) model is $Y_t-6.28 = .825(Y_{t-1}-6.28) + e_t$.

```{r}
# fit the seasonal model
SAR1model = arima(savings, order = c(1, 0, 0), seasonal = list(order = c(1, 0, 0), period = 4), method=c('ML'))
SAR1model
```

And here are the parameters for the multiplicative seasonal model. Given these parameters, the seasonal model is given by $(Y_t-6.27)(1-.861(B-6.27))(1+.228(B-6.27)^4) = e_t$



# Diagnostics

These two models are almost indistinguishable in terms of error. The AR(1) model has a higher AIC and BIC, but the seasonal model has a standard error, and none of the differences between the two models are substantial. Our error measurements don't give us much insight into which model is best, so we should turn to forecasting to see which model is more accurate in predicting future terms.

```{r}
tsdiag(AR1model)
tsdiag(SAR1model)
```

```{r}
ARresids = rstandard(AR1model)
SARresids = rstandard(SAR1model)

qqnorm(ARresids)
qqnorm(SARresids)

shapiro.test(ARresids)
shapiro.test(SARresids)

runs(ARresids)
runs(SARresids)
```



# Forecasting



```{r}
sarima.for(savings,n.ahead = 6, 1, 0, 0, P = 0, D = 0, Q = 0, S = 0)
points(79:84,savings.test, col="blue")
```

```{r}
sarima.for(savings,n.ahead = 6, 1, 0, 0, P = 1, D = 0, Q = 0, S = 4)
points(79:84,savings.test, col="blue")
```


